<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta charset="utf-8" />
    <title>map-creator</title>

    <link rel="stylesheet" type="text/css" href="/style/map-creator.css" />
    <script defer src="https://kit.fontawesome.com/eeafe44cad.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="canvas-wrapper">
        <canvas id="main-canvas"></canvas>
    </div>

    <div class="nav">
        <a id="exit-creator" class="icon" title="Zurück zur Übersicht" href="/map"><i class="fas fa-arrow-circle-left"></i></a>
        <div class="title">
            <h3 id="map-name"></h3>
            <span id="map-version"></span>
        </div>
        {{#if is_admin}}
        <div id="save-map" class="icon" title="Karte speichern [Strg + s]">
            <i class="far fa-save"></i>
        </div>
        <div id="save-map-as" class="icon" title="Karte speichern als [Strg + Umschalt + s]">
            <i class="fas fa-save"></i>
        </div>
        {{/if}}
        <div id="open-map" class="icon" title="Karte öffnen [Strg + o]">
            <i class="far fa-folder-open"></i>
        </div>
    </div>

    <div id="map-opener-back" class="dialogue-back">
        <div class="map-opener dialogue">
            <i id="close-map-opener" class="far fa-times-circle close-dialogue"></i>
            <h3>Karte öffnen ... </h3>
            <div id="map-opener-items"> 
            </div>
            <div class="btn-container">
                <div id="map-opener-open" class="dialogue-sub-btn disabled">
                    Öffnen
                </div>
            </div>
        </div>
    </div>

    {{#if is_admin}}
    <div id="map-saver-back" class="dialogue-back">
        <div class="map-saver dialogue">
            <i id="close-map-saver" class="far fa-times-circle close-dialogue"></i>
            <h3>Karte speichern als ... </h3>
            <div id="map-saver-items">
                <span>default</span><span>test</span>
            </div>
            <div class="btn-container">
                <div class="input-group">
                    <div class="input-group-inputs">
                        <input type="text" id="map-saver-name" placeholder="Kartenname ... " title="Name" autocomplete="off" spellcheck="false" />
                        <input type="text" id="map-saver-version" placeholder="Kartenversion ... " title="Version" autocomplete="off" spellcheck="false" />
                    </div>
                    <span class="map-saver-err-msg">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="map-saver-err-content"></span> 
                    </span>
                    <span class="map-saver-wrn-msg">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span id="map-saver-wrn-content"></span> 
                    </span>
                </div>
                <div id="map-saver-save" class="dialogue-sub-btn disabled">
                    Speichern
                </div>
            </div>
        </div>
    </div>
    {{/if}}

    <div id="loading-back">
        <div id="loading">
            <div class="loading-anim"></div>
            <span>Lädt ...</span>
        </div>
    </div>

    {{#if is_admin}}
    <div id="node-info">
        <div id="node-info-title" contenteditable="true" spellcheck="false">Titel</div>
        <div id="node-info-desc" contenteditable="true" spellcheck="false">Beschreibung</div>
    </div>

    <div id="stairs-info">
        <div>
            <label for="stairs-info-height">Höhe</label>
            <input id="stairs-info-height" type="number" placeholder="Height ... " />
        </div>
    </div>

    <div id="key-code-wrapper">
        <div class="key-codes">
            <div class="close-wrapper">
                <h3>Tastaturkombinationen</h3>
                <i id="close-key-codes" class="far fa-times-circle" title="Close"></i>
            </div>
            <div class="shortcut-div">
                <div>
                    <div>
                        <span class="key">d</span> oder <span class="key">0</span>
                    </div>
                    <div>
                        Maus-Werkzeug auswählen
                    </div>
                </div>
                <div>
                    <div>
                        <span class="key">m</span> oder <span class="key">1</span>
                    </div>
                    <div>
                        Verschieben auswählen
                    </div>
                </div>
                <div>
                    <div>
                        <span class="key">e</span> oder <span class="key">2</span>
                    </div>
                    <div>
                        Endpunkt-Werkzeug auswählen
                    </div>
                </div>
                <div>
                    <div>
                        <span class="key">n</span> oder <span class="key">3</span>
                    </div>
                    <div>
                        Knoten-Werkzeug auswählen
                    </div>
                </div>
                <div>
                    <div>
                        <span class="key">c</span> oder <span class="key">4</span>
                    </div>
                    <div>
                        Verbinden auswählen
                    </div>
                </div>
                <div>
                    <div>
                        <span class="key">r</span> oder <span class="key">5</span>
                    </div>
                    <div>
                        Entfernen auswählen
                    </div>
                </div>
                <div>
                    <div>
                        <span class="key">s</span> oder <span class="key">6</span>
                    </div>
                    <div>
                        Stiegen-Werkzeug auswählen
                    </div>
                </div>
                <div>
                    <div>
                        <span class="key">b</span> oder <span class="key">7</span>
                    </div>
                    <div>
                        BLE-Werkzeug auswählen
                    </div>
                </div>
                <div>
                    <div>
                        <span class="key">Ctrl</span> + <span class="key">+</span>
                    </div>
                    <div>
                        Zu oberem Geschoss wechseln
                    </div>
                </div>
                <div>
                    <div>
                        <span class="key">Ctrl</span> + <span class="key">-</span>
                    </div>
                    <div>
                        Zu unterem Geschoss wechseln
                    </div>
                </div>
                <div>
                    <div>
                        <span class="key">Ctrl</span> + <span class="key">Shift</span> + <span class="key">?</span>
                    </div>
                    <div>
                        Alle Tastaturkombinationen anzeigen
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="side-bar">
        <div class="tools">
            <div id="pan-tool" class="active-tool" title="Pan (d)">
                <i class="fas fa-mouse-pointer"></i>
            </div>
            <div id="move-tool" title="Move (m)">
                <i class="fas fa-arrows-alt"></i>
            </div>
            <div id="goal-tool" title="Endpoint (e)">
                <i class="fas fa-monument"></i>
            </div>
            <div id="node-tool" title="Add node (n)">
                <i class="fas fa-circle"></i>
            </div>
            <div id="conn-tool" title="Add connection (c)">
                <i class="fas fa-long-arrow-alt-right"></i>
            </div>
            <div id="del-tool" title="Delete (r)">
                <i class="fas fa-cut"></i>
            </div>
            <div id="flr-tool" title="Add staircase (s)">
                <i class="fas fa-hiking"></i>
            </div>
            <div id="ble-tool" title="Add BLE beacon (b)">
                <i class="fas fa-broadcast-tower"></i>
            </div>
        </div>

        <div class="floor-tools">
            <div id="floor-up" title="Floor above (Ctrl + +)">
                <i class="fas fa-chevron-circle-up"></i>
            </div>
            <div id="floor-out" title="Current floor">
                0
            </div>
            <div id="floor-down" class="disabled" title="Floor below (Ctrl + -)">
                <i class="fas fa-chevron-circle-down"></i>
            </div>
        </div>
    </div> 

    <script src="/scripts/compare-versions.js"></script>
    <script src="/scripts/Edge.js"></script>
    <script src="/scripts/Node.js"></script>
    <script src="/scripts/EndNode.js"></script>
    <script src="/scripts/StairsNode.js"></script>
    <script src="/scripts/BeaconNode.js"></script>
    <script src="/scripts/mapi.js"></script>
    <script src="/scripts/map_creator.js"></script>   

    {{else}}
    <script src="/scripts/mapi.js"></script>
    <script>
        window.onload = () => {
            let mapi = getMapi();

            mapi.can = document.getElementById('main-canvas');
            mapi.ctx = mapi.can.getContext('2d');
            mapi.cab = mapi.can.getBoundingClientRect();

            let cpa = mapi.can.parentElement,
                cpb = cpa.getBoundingClientRect();

            window.onresize = () => {
                mapi.can.width = cpb.width - 2;
                mapi.can.height = Math.min(cpb.height - 2, mapi.conf.map.height * mapi.conf.m2px);

                mapi.conf.ox = 0;
                mapi.conf.oy = 0;

                mapi.cab = mapi.can.getBoundingClientRect();
                mapi.refresh();
            };

            mapi.init();
        };
    </script>
    {{/if}}
</body>

</html>